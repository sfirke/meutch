{# Share button partial - include with: {% include 'share/_share_button.html' %} #}
{# Required variables: share_url (str), share_title (str) #}
<button type="button" 
        class="btn btn-outline-primary share-btn"
        data-share-url="{{ share_url }}"
        data-share-title="{{ share_title }}"
        title="Share"
        onclick="shareLink(this)">
    <i class="fas fa-share-nodes me-1"></i>Share
</button>

<script>
function shareLink(button) {
    const url = button.getAttribute('data-share-url');
    const title = button.getAttribute('data-share-title');
    
    if (navigator.share) {
        navigator.share({
            title: title,
            url: url
        }).catch(function(err) {
            // User cancelled or error - fall back to clipboard
            if (err.name !== 'AbortError') {
                copyToClipboardFallback(url, button);
            }
        });
    } else {
        copyToClipboardFallback(url, button);
    }
}

function copyToClipboardFallback(url, button) {
    navigator.clipboard.writeText(url).then(function() {
        // Update button to show success
        var originalHTML = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check me-1"></i>Link Copied!';
        button.classList.remove('btn-outline-secondary');
        button.classList.add('btn-success');
        
        setTimeout(function() {
            button.innerHTML = originalHTML;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-secondary');
        }, 2000);
    }).catch(function() {
        // Final fallback: select text in a temporary input
        var tempInput = document.createElement('input');
        tempInput.value = url;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        
        var originalHTML = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check me-1"></i>Link Copied!';
        button.classList.remove('btn-outline-secondary');
        button.classList.add('btn-success');
        
        setTimeout(function() {
            button.innerHTML = originalHTML;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-secondary');
        }, 2000);
    });
}
</script>
